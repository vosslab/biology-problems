# Changelog

## 2026-01-30
- Added RDKit-based histidine protonation state PGML question in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml) showing all four charge states across pH ranges with pKa values of 1.82, 6.00, and 9.17.
- Corrected imidazole ring SMILES in histidine protonation states to use NH and NH+ for the protonated form (not NH2+) and NH and N for the neutral form in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Removed pKa-to-group assignments from the histidine question prompt so students must determine which pKa corresponds to which ionizable group, keeping assignments in the solution for learning in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Updated histidine question to Level 4 (Analyze) since students must infer pKa-to-group assignments and analyze protonation states in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Fixed PGML rendering by replacing invalid `[!div .class]` syntax with proper HTML div wrappers in Perl variables in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Created comprehensive RDKit.js molecular structures guide in [docs/webwork/RDKIT_MOLECULAR_STRUCTURES.md](webwork/RDKIT_MOLECULAR_STRUCTURES.md) covering SMILES syntax, charged species notation, imidazole protonation chemistry, validation workflow, canvas sizing, rendering options, and common pitfalls.
- Added section to randomization reference clarifying that built-in random() functions are already seeded with $problemSeed and showing correct PGrandom instance seeding pattern (srand on instance, not class method) in [docs/webwork/RANDOMIZATION_REFERENCE.md](webwork/RANDOMIZATION_REFERENCE.md).
- Corrected randomization documentation to show the working PGrandom pattern used throughout the repo ($local_random->srand) vs incorrect class method calls in [docs/webwork/RANDOMIZATION_REFERENCE.md](webwork/RANDOMIZATION_REFERENCE.md).
- Implemented inline radio buttons next to each histidine structure canvas to eliminate scroll-and-remember UX problem using HTML radio inputs with JavaScript sync to WebWork answer field in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Added text descriptions of protonation states (carboxyl, amino, imidazole) below each radio button for accessibility and to help visually impaired students in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Simplified histidine question to use legacy ANS() with str_cmp instead of complex PGML inline grading to avoid JavaScript complexity and PGML parsing issues in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Changed imidazole notation from "NH + NH+" to "NH and NH+" to avoid confusion between plus sign separator and superscript charge symbol in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Added two impossible distractor states to histidine question that violate pKa deprotonation order (State 5: imidazole charged but amino not; State 6: carboxyl charged but amino not) to test understanding of sequential deprotonation in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Enhanced solution to explain why States 5 and 6 are impossible and reinforce the principle that groups deprotonate in order of increasing pKa in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Added visual emphasis to pH value in histidine question using blue badge style (color, size, background, border-radius) following which_hydrophobic-simple.pgml pattern in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Implemented shuffling of all 6 histidine states to prevent students from memorizing position-based answers in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Created comprehensive question statement emphasis guide in [docs/webwork/QUESTION_STATEMENT_EMPHASIS.md](webwork/QUESTION_STATEMENT_EMPHASIS.md) covering HTML span techniques, color palettes, font sizing, accessibility, and complete working examples for pH values, key terms, negations, and measurements.
- Added QUESTION_STATEMENT_EMPHASIS.md to WebWork documentation index in [docs/webwork/INDEX.md](webwork/INDEX.md).
- Fixed canvas rendering bug by moving shuffle code after card definitions to ensure variables are defined before use in [problems/biochemistry-problems/histidine_protonation_states.pgml](../problems/biochemistry-problems/histidine_protonation_states.pgml).
- Created comprehensive PG common pitfalls guide in [docs/webwork/PG_COMMON_PITFALLS.md](webwork/PG_COMMON_PITFALLS.md) covering order of operations, PGML parsing issues, HTML escaping, loops in BEGIN_TEXT, shuffling patterns, answer checking, debugging strategies, and prevention checklist.
- Added PG_COMMON_PITFALLS.md to WebWork documentation index in [docs/webwork/INDEX.md](webwork/INDEX.md).
- Added molecular structures question type section with RDKit.js pattern and example references to [docs/webwork/PGML_QUESTION_TYPES.md](webwork/PGML_QUESTION_TYPES.md).
- Added RDKIT_MOLECULAR_STRUCTURES.md and ORDERING_PROBLEMS.md to the WebWork documentation index in [docs/webwork/INDEX.md](webwork/INDEX.md).
- Added biochemistry and molecular biology Level assessment examples (Levels 1-6) to help authors calibrate question difficulty in [docs/webwork/WEBWORK_HEADER_STYLE.md](webwork/WEBWORK_HEADER_STYLE.md).

## 2026-01-29
- Capped amino-acid PubChem generators at 20 questions with early stop logic in [problems/biochemistry-problems/PUBCHEM/which_amino_acid.py](../problems/biochemistry-problems/PUBCHEM/which_amino_acid.py) and [problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.py](../problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.py).
- Refactored the amino-acid PubChem generators to use single-question collection via `collect_and_write_questions` and a shared PubChem client in [problems/biochemistry-problems/PUBCHEM/which_amino_acid.py](../problems/biochemistry-problems/PUBCHEM/which_amino_acid.py) and [problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.py](../problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.py).
- Added a draggable ordering PGML example in [webwork_examples/ordering_entropy.pgml](../webwork_examples/ordering_entropy.pgml) and documented ordering questions in [docs/webwork/PGML_QUESTION_TYPES.md](webwork/PGML_QUESTION_TYPES.md) plus the new [docs/webwork/ORDERING_PROBLEMS.md](webwork/ORDERING_PROBLEMS.md).
- Added RDKit-based amino acid identification and matching PGML problems in [problems/biochemistry-problems/PUBCHEM/which_amino_acid.pgml](../problems/biochemistry-problems/PUBCHEM/which_amino_acid.pgml) and [problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.pgml](../problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.pgml).
- Switched [webwork_examples/ordering_entropy.pgml](../webwork_examples/ordering_entropy.pgml) to a PopUp-based ordering pattern so it avoids a standalone `ANS(...)` block.
- Restored the drag-and-drop `DraggableProof` version of [webwork_examples/ordering_entropy.pgml](../webwork_examples/ordering_entropy.pgml), which requires a standalone `ANS(...)` evaluator.
- Reorganized the section headers in the new amino-acid PGML files to match the canonical numbered component layout in [problems/biochemistry-problems/PUBCHEM/which_amino_acid.pgml](../problems/biochemistry-problems/PUBCHEM/which_amino_acid.pgml) and [problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.pgml](../problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.pgml).
- Switched the ordering example and docs to the inline `[_]{$ordering}` DraggableProof pattern in [webwork_examples/ordering_entropy.pgml](../webwork_examples/ordering_entropy.pgml), [docs/webwork/PGML_QUESTION_TYPES.md](webwork/PGML_QUESTION_TYPES.md), and [docs/webwork/ORDERING_PROBLEMS.md](webwork/ORDERING_PROBLEMS.md).
- Restored the ordering example and docs to the `->Print` + `ANS(...)` DraggableProof pattern with `MathObjects.pl` after the inline blank failed in the PG 2.17 renderer, updating [webwork_examples/ordering_entropy.pgml](../webwork_examples/ordering_entropy.pgml), [docs/webwork/PGML_QUESTION_TYPES.md](webwork/PGML_QUESTION_TYPES.md), and [docs/webwork/ORDERING_PROBLEMS.md](webwork/ORDERING_PROBLEMS.md).
- Added required solution sections to the amino-acid PGML problems in [problems/biochemistry-problems/PUBCHEM/which_amino_acid.pgml](../problems/biochemistry-problems/PUBCHEM/which_amino_acid.pgml) and [problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.pgml](../problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.pgml).
- Made the amino-acid solution text plain ASCII in [problems/biochemistry-problems/PUBCHEM/which_amino_acid.pgml](../problems/biochemistry-problems/PUBCHEM/which_amino_acid.pgml).
- Added a blank default choice to the amino-acid matching dropdowns in [problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.pgml](../problems/biochemistry-problems/PUBCHEM/match_amino_acid_structures.pgml).
- Enabled partial-credit scoring and added a solution line for the ordering example in [webwork_examples/ordering_entropy.pgml](../webwork_examples/ordering_entropy.pgml), and documented partial credit in [docs/webwork/ORDERING_PROBLEMS.md](webwork/ORDERING_PROBLEMS.md).
- Kept the ordering example on the `->Print` + `ANS(...)` DraggableProof path after reconfirming the inline `[_]{$ordering}` pattern fails in the renderer in [webwork_examples/ordering_entropy.pgml](../webwork_examples/ordering_entropy.pgml).
- Required solution blocks in the authoring guide, updating the canonical skeleton and template in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).
- Added a PGML version of the ionic-bond amino acid question in [problems/biochemistry-problems/ionic_bond_amino_acids.pgml](../problems/biochemistry-problems/ionic_bond_amino_acids.pgml).
- Fixed ionic-bond PGML random selection to avoid array-reference errors in [problems/biochemistry-problems/ionic_bond_amino_acids.pgml](../problems/biochemistry-problems/ionic_bond_amino_acids.pgml).
- Added an ionic-bond hint block to [problems/biochemistry-problems/ionic_bond_amino_acids.pgml](../problems/biochemistry-problems/ionic_bond_amino_acids.pgml).
- Emphasized the ionic bond phrase in [problems/biochemistry-problems/ionic_bond_amino_acids.pgml](../problems/biochemistry-problems/ionic_bond_amino_acids.pgml).
- Added an easy-mode dipeptide sequence PGML question in [problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml](../problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml).
- Updated the easy dipeptide PGML choices to use full amino acid names in [problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml](../problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml).
- Fixed RDKit peptide bond highlighting initialization in [problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml](../problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml) to prevent rendering failures.
- Hardened RDKit peptide bond matching in [problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml](../problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml) so missing query support falls back to unhighlighted rendering instead of stopping the draw.
- Set the dipeptide canvas to a 16:9 aspect ratio in [problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml](../problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml).
- Converted [problems/biochemistry-problems/PUBCHEM/rdkit_working_in_webwork.pgml](../problems/biochemistry-problems/PUBCHEM/rdkit_working_in_webwork.pgml) to PGML structure with required numbered sections and a solution block for RDKit reference.
- Made dipeptide choice generation seed-stable by tracking ordered choices instead of relying on hash key order in [problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml](../problems/biochemistry-problems/PUBCHEM/polypeptide_mc_sequence-easy.pgml).
- Extended PGML color span handling to support multiple strict color spans in a single string for matching and which-one generators in [webwork_lib.py](../webwork_lib.py).
- Updated WebWork replacement handling to avoid nested replacements while preserving rule order in [webwork_lib.py](../webwork_lib.py).
- Stopped emitting empty TitleText/Edition/Author/Section/Problem header tags in YAML-to-PGML generators by omitting blank values in [webwork_lib.py](../webwork_lib.py).
- Switched which-one PGML generator labels to the auto-expanding 'ABC' setting instead of a fixed A-H list in [problems/matching_sets/yaml_which_one_mc_to_pgml.py](../problems/matching_sets/yaml_which_one_mc_to_pgml.py).
- Added `--flip` support to swap keys/values when generating matching PGML files in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py), choosing a single key when duplicate descriptions collide in the flipped direction.
- Appended `-matching-flip` to the default output filename when `--flip` is used in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py).
- Preserved strict color spans in matching prompts by formatting value text through the HTML color formatter in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py).
- Rendered matching prompt values with PGML HTML output (`*`) so color spans display instead of escaping in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py).

## 2026-01-28
- Added functional-group color styling in both the PGML and BBQ generator for the bond-type question in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml) and [problems/biochemistry-problems/functional_groups_bond_types.py](../problems/biochemistry-problems/functional_groups_bond_types.py).
- Added a BBQ generator for the pH vs [H+] comparison question in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.py](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.py).
- Added per-context colors, emphasized sample names, and monospace pH values in the pH vs [H+] prompt, extending the contexts with a color key in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Added a BBQ generator for the functional-group bond-type question in [problems/biochemistry-problems/functional_groups_bond_types.py](../problems/biochemistry-problems/functional_groups_bond_types.py).
- Restored the "three (3)" phrasing in the functional-group bond-type prompts for consistency in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Simplified unique sampling to a shuffle-and-slice and revised single/double bond prompt wording in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Made the pH vs [H+] solution text ASCII-only by separating plain power-of-ten labels from HTML superscripts in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Reworked the functional-group bond-type randomization to use PG random helpers only, build correct single/double trios explicitly, and generate mixed-category distractors with uniqueness guards in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Switched power-of-ten labels in the pH vs [H+] choices to use HTML superscripts for exponents in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Folded the word "only" into the blue emphasis for single-bond prompts in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Fixed the single-bond variant to still select three groups after adding methyl by sampling a target pool size in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Added methyl to the single-bond functional-group pool in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Removed the unused other-group pool and replaced the hard-coded bond hash with list membership checks in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Removed inline HTML tags from the pH comparison prompt to avoid PGML escaping and kept plain text with variable interpolation in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Exposed pH prompt variables as PGML-visible globals and restored inline HTML paragraphs for the pH vs [H+] prompt in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Rendered the pH comparison prompt as single-line PGML HTML wrappers instead of escaped inline tags in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Replaced the pH comparison prompt string builder with inline PGML text and formatted pH variables in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Emphasized single/double bond phrasing with colored spans in the functional-group bond-type prompt in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Expanded the pH comparison contexts and added jittered integer-difference pairing logic for pH vs [H+] questions in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Rebuilt the functional-group bond-type question to generate distractors from single-, double-, and other-group lists while preventing conceptually correct distractors in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Standardized functional-group choice capitalization to lowercase in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Shuffled the order of functional-group names within each answer choice for the bond-type question in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Kept the pH-unit difference in the same paragraph as the pH values for the pH vs [H+] comparison prompt in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Added the explicit pH-unit difference to the prompt text for the pH vs [H+] comparison problem in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Added a randomized functional-group bond-type multiple choice question with double-bond and single-bond variants in [problems/biochemistry-problems/functional_groups_bond_types.pgml](../problems/biochemistry-problems/functional_groups_bond_types.pgml).
- Added an algorithmic pH vs [H+] comparison problem with randomized real-world samples and log-scale distractors in [problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml](../problems/biochemistry-problems/buffers/ph_h_concentration_ratio.pgml).
- Ordered the optimal buffering range pH choices numerically in [problems/biochemistry-problems/buffers/optimal_buffering_range.pgml](../problems/biochemistry-problems/buffers/optimal_buffering_range.pgml).
- Added a shared pH vs pKa protonation hint block to the diprotic, triprotic, and tetraprotic buffer PGML problems in [problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml), [problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml), and [problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml).
- Simplified fixed-length pKa wording in the diprotic, triprotic, and tetraprotic buffer PGML problems by replacing the generic list formatter with direct two/three/four-value strings in [problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml), [problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml), and [problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml).
- Replaced index-based buffer and pH selection with a local RNG helper for cleaner list choices in [problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml), [problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml), and [problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml).
- Removed randomization references that are not present in the local renderer snapshot from [docs/webwork/RANDOMIZATION_REFERENCE.md](webwork/RANDOMIZATION_REFERENCE.md).
- Pruned non-renderer randomization notes from [docs/webwork/RANDOMIZATION_REFERENCE.md](webwork/RANDOMIZATION_REFERENCE.md) to keep only macros available in the local snapshot.
- Updated [docs/webwork/RANDOMIZATION_REFERENCE.md](webwork/RANDOMIZATION_REFERENCE.md) to reflect the renderer snapshot (no `random_subset`, avoid deprecated `NchooseK`/`shuffle`, prefer local `PGrandom`).
- Simplified buffer protonation PGML helpers to use per-file color arrays and generated pH lists in [problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml), [problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml), and [problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml).
- Simplified choice randomization in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) by removing the manual shuffle and deprecated NchooseK usage, inserting the correct answer at a random position with a local RNG.
- Added diprotic, triprotic, and tetraprotic protonation-state PGML problems derived from pKa buffer state logic in [problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-diprotic.pgml), [problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-triprotic.pgml), and [problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml](../problems/biochemistry-problems/buffers/pKa_buffer_state-tetraprotic.pgml).
- Removed `TEXT(beginproblem());` from PGML problems and documented that it should be omitted for ADAPT in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).
- Updated the DBchapter in [problems/biochemistry-problems/buffers/optimal_buffering_range.pgml](../problems/biochemistry-problems/buffers/optimal_buffering_range.pgml) to "Chemistry of Water" for the current chapter.
- Updated the TITLE in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) to explicitly signal genetics context.
- Collapsed the DESCRIPTION in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) into a single paragraph line.
- Removed "practice" from the TITLE in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml).
- Updated DBsubject/DBchapter in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) to match the genetics chapter taxonomy.
- Reorganized [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) comments to follow the OPL header, Preamble, Setup, Statement, Solution component structure.
- Added Level and Language header tags to [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) to match the new header requirements.
- Added required GitHub contact and CC BY 4.0 / LGPL v3 license comments to [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and documented the new requirement in [docs/webwork/WEBWORK_HEADER_STYLE.md](webwork/WEBWORK_HEADER_STYLE.md).
- Clarified CC BY 4.0 wording and removed "if any" from LGPLv3 language in [docs/webwork/WEBWORK_HEADER_STYLE.md](webwork/WEBWORK_HEADER_STYLE.md) and [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml).
- Updated [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) with the new header fields, required GitHub/license comments, and Preamble/Setup/Statement/Solution section headings.
- Removed the unnecessary MODES wrapper for the hydrophobic emphasis span in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) and kept it as plain HTML.
- Updated WebWork authoring docs to use MODES only when needed for HTML rendering, not for TeX output management (see [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md), [docs/webwork/MATCHING_PROBLEMS.md](webwork/MATCHING_PROBLEMS.md), [docs/webwork/HTML_TO_WEBWORK_PLAN.md](webwork/HTML_TO_WEBWORK_PLAN.md), and [docs/webwork/PGML_LINTER_EXPECTATIONS.md](webwork/PGML_LINTER_EXPECTATIONS.md)).
- Refined MODES guidance in [docs/webwork/PGML_QUESTION_TYPES.md](webwork/PGML_QUESTION_TYPES.md) and [docs/webwork/HTML_TO_WEBWORK_PLAN.md](webwork/HTML_TO_WEBWORK_PLAN.md) to emphasize HTML emission needs rather than TeX handling.
- Removed MODES usage for CSS header injection in the YAML-to-PGML generators ([problems/matching_sets/yaml_which_one_mc_to_pgml.py](../problems/matching_sets/yaml_which_one_mc_to_pgml.py), [problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py](../problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py)) and updated docs to drop TeX-empty wording in MODES examples. Restored MODES layout wrappers in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) after testing showed raw wrapper HTML was escaped in PGML output.
- Added a matching-layout note in [docs/webwork/MATCHING_PROBLEMS.md](webwork/MATCHING_PROBLEMS.md) explaining when MODES is required for HTML emitted from Perl and what breaks when it is removed.
- Removed MODES wrappers from [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml) in favor of plain HTML strings, and kept MODES for the layout wrappers in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) where HTML must be emitted from Perl.
- Added a "MODES Usage Guidance Summary" section to [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md) to clarify when MODES is required and when plain HTML is preferred.
- Updated [docs/webwork/WEBWORK_HEADER_STYLE.md](webwork/WEBWORK_HEADER_STYLE.md) to allow TITLE lines up to 90 characters and removed empty TitleText fields from [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) and [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml), while collapsing the chemical_group_pka_forms DESCRIPTION into a single paragraph line.
- Normalized PGML headers across local files by adding TITLE/Level/Language/GitHub/license fields, filling DBchapter/DBsection, and standardizing author/institution in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml), [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml), [problems/matching_sets/macromolecules-matching.pgml](../problems/matching_sets/macromolecules-matching.pgml), [problems/matching_sets/macromolecules-biol301-matching.pgml](../problems/matching_sets/macromolecules-biol301-matching.pgml), and [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml).
- Added [problems/biochemistry-problems/buffers/optimal_buffering_range.pgml](../problems/biochemistry-problems/buffers/optimal_buffering_range.pgml) as a PGML adaptation of the optimal buffering range question with updated headers, colored pH choices, and inline radio grading.
- Updated [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md) to require the OPL header, Preamble, Setup, Statement, Solution component structure and matching section headings.
- Clarified in [docs/webwork/WEBWORK_HEADER_STYLE.md](webwork/WEBWORK_HEADER_STYLE.md) that titles should include course context in large banks, avoid "practice", and keep DESCRIPTION as a single-paragraph line.
- Expanded [docs/webwork/WEBWORK_HEADER_STYLE.md](webwork/WEBWORK_HEADER_STYLE.md) with required DBsection/Level/Language guidance, a license comment pattern, optional textbook mappings, contact-link comment examples, a local life science DBsubject list (including Biomedical Sciences and Immunology), and Level descriptions aligned to the revised Bloom order (Remember through Create), plus clarified DBsubject wording to refer to repo strings.
- Switched [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) to use a plain ASCII solution string for ADAPT instead of the styled HTML choice text.
- Clarified in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md) that BEGIN_PGML_SOLUTION must be plain ASCII for ADAPT exports.
- Pointed [tests/yaml/test_matching_sets_yaml_generators.py](../tests/yaml/test_matching_sets_yaml_generators.py) at the current matching-set BBQ generators ([problems/matching_sets/yaml_match_to_bbq.py](../problems/matching_sets/yaml_match_to_bbq.py), [problems/matching_sets/yaml_which_one_mc_to_bbq.py](../problems/matching_sets/yaml_which_one_mc_to_bbq.py)).
- Added a default inline color_mode for build_pgml_text in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) and [problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py](../problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py) so older callers still receive a plain PGML string.
- Renamed `problems/biochemistry-problems/acid_base_pka_forms_checkbox.pgml` to [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Removed MODES wrappers from scenario prompt strings in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Removed unnecessary temporary string variables for base form labels in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Added [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) with four checkbox parts covering carboxyl and amine protonation states above and below pKa.
- Reworked [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to use paired radio-button lists for hydrogens and charge per scenario after CheckboxList failed to render in the local renderer.
- Restored CheckboxList-based checkboxes in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) so each scenario uses two checkbox selections for hydrogens and charge.
- Updated [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to randomly select one of the four scenarios per seed so students see only a single version.
- Added [docs/webwork/PG_2_17_RENDERER_MACROS.md](webwork/PG_2_17_RENDERER_MACROS.md) to document the renderer snapshot macro allowlist, and linked it from [docs/webwork/INDEX.md](webwork/INDEX.md).
- Switched [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to PGbasicmacros checkbox rendering with `ans_checkbox` and `checkbox_cmp` to avoid missing CheckboxList macros.
- Fixed prompt rendering in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to output the selected scenario text in PGML.
- Adjusted [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to emit the prompt and checkbox HTML via `[@ ... @]*` for reliable PGML rendering.
- Moved prompt and checkbox HTML variables to package scope in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) so PGML can access them.
- Replaced checkbox rendering in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) with PopUp lists to avoid legacy `ANS` usage while keeping one-scenario randomization.
- Removed `TEXT(beginproblem())` from [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to keep PGML-only output.
- Switched [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to dual radio-button lists with subscripted group forms and colorized charge options.
- Dropped the `Context("String")` call in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) because the trimmed PG 2.17 renderer does not include that context.
- Adjusted radio-button labels in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to show A/B/C-style letters instead of "Choice 1" text.
- Simplified form options in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to focus on NH2/COOH and add thiol (SH2+, SH, S-) variants with updated prompts, keywords, and solutions.
- Set TeX output to empty for subscripted/superscripted forms, charge labels, and prompts in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Arranged form and charge radio lists into a two-column flex layout in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Expanded form choice lists in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to include COOH2, SH2, and additional amine forms without embedding charge in the form text.
- Put the Form and Charge headers on their own lines in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to avoid sharing the line with choice A.
- Added in-file comments in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) explaining the use of unrealistic distractor forms and separate charge selection.
- Added COOH3 and SH3 distractor forms and dropped plain N so each form list has four choices in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Adjusted prompt phrasing in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to remove "for example" and use parenthetical group notation.
- Removed the unused form mapping table in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) and stored correct form objects directly in the scenarios.
- Emphasized ABOVE/BELOW and group type labels with color styling in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Documented the recommended question ordering (background, statement, data/table, directions) in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).
- Consolidated scenario prompt wording in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to reduce repeated text and make future edits easier.
- Switched radio-button answer keys in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to index-based correct choices to fix grading with HTML-labeled options.
- Documented emphasis styling for critical words in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).
- Added a general pH vs pKa hint, reordered form choices to a protonation-based order, and keyed radio answers to the choice strings in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Switched radio-button keys to index lookup from the choice lists and trimmed the hint source line in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Replaced RadioButtons with hidden PopUp grading synced to custom radio UI HTML so the local renderer grades correctly in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Documented the PG 2.17 radio-button grading failure and suspected renderer cause in [docs/webwork/RADIOBUTTONS_GRADING_BUG_PG_2_17.md](webwork/RADIOBUTTONS_GRADING_BUG_PG_2_17.md).
- Restored the RadioButtons-based layout in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) to match the ADAPT behavior and removed the PopUp/JS workaround.
- Removed key-to-index mapping helpers in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) and set scenario indices directly for form/charge choices.
- Consolidated the two-column PGML layout HTML into reusable MODES variables in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Removed the MathJax-mode layout overrides in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) per renderer guidance.
- Restored the explicit MODES-based two-column layout block in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml) for Form/Charge headers.
- Refactored subscripted group forms to use a shared `subscript()` helper in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Consolidated HTML-only strings into a shared `html_only()` helper in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Removed the `html_only()` helper and left plain strings for non-HTML values in [problems/biochemistry-problems/chemical_group_pka_forms.pgml](../problems/biochemistry-problems/chemical_group_pka_forms.pgml).
- Clarified in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md) that `MODES(...)` should only be used for mode-specific output and that TeX entries should be empty when used.
- Aligned `MODES(...)` guidance across [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md) and [docs/webwork/MATCHING_PROBLEMS.md](webwork/MATCHING_PROBLEMS.md) to keep TeX output empty and avoid MODES wrappers for plain text.
- Clarified across WebWork docs that HTML `table`/`tr`/`td`/`th` tags are blocked and that `niceTables.pl` is the only supported way to create tables in this install.
- Added guidance to merge consecutive HTML-only `MODES(...)` calls into a single wrapper in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md) and linter expectations in [docs/webwork/PGML_LINTER_EXPECTATIONS.md](webwork/PGML_LINTER_EXPECTATIONS.md).
- Added a literal before/after example showing how to merge consecutive `MODES(...)` calls in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).
- Clarified in [docs/webwork/HTML_TO_WEBWORK_PLAN.md](webwork/HTML_TO_WEBWORK_PLAN.md) that TeX output is intentionally empty and that HTML-only layout should use `MODES(TeX => '', HTML => ...)` rather than tag wrappers.
- Updated WebWork docs to include `th` alongside `table`/`tr`/`td` in blocked-tag and table-guard guidance.
- Updated the WebWork docs to move table handling into a niceTables conversion phase instead of skipping table content, and clarified table-guard behavior in replacement/color plans.
- Clarified randomization guidance to use the built-in `problemSeed` when seeding local RNGs.
- Added [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) as a PGML version of the fly cross question, using niceTables for the phenotype table.
- Fixed phenotype classification in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) to reliably detect red/white genotypes without regex escaping issues.
- Updated [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py) to alphabetize choices, add sex symbols, and style genotypes and wildtype/mutant labels for readability.
- Updated [docs/webwork/WEBWORK_HEADER_STYLE.md](webwork/WEBWORK_HEADER_STYLE.md) to cap KEYWORDS at 5 (prefer 3) and to use the author/institution defaults from `docs/AUTHORS.md`.
- Updated [docs/webwork/WEBWORK_HEADER_STYLE.md](webwork/WEBWORK_HEADER_STYLE.md) to require a short TITLE line (single sentence, <= 80 chars) and a 2-3 sentence DESCRIPTION for ADAPT alignment.
- Standardized RadioButtons labels to `labels => 'ABC'` in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/multiple_choice_statements/multiple_choice_statements.pgml](../problems/multiple_choice_statements/multiple_choice_statements.pgml).
- Standardized `labels => 'ABC'` in PGML RadioButtons usage and documented the requirement in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).
- Adjusted genotype rendering in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py) to use `+-`/`w-` and prevent unwanted uppercase styling.
- Styled the "white-eyed (mutant)" table row to 90% gray in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py).
- Matched allele glyph styling in the stem to genotype styling and reduced genotype font weight in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py).
- Added colored sex symbols (female #990070, male #002499) in the table headers and choices for [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py).
- Adjusted genotype span styling to 0.95em with heavier weight in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py).
- Switched sex-color styling to the words "female" and "male" (symbols remain black) in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py).
- Restored sex symbol parentheses in [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py) so table headers, choices, and the stem match PGML styling.
- Added TITLE and expanded DESCRIPTION metadata in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml), trimmed KEYWORDS, and aligned Author/Institution with `docs/AUTHORS.md`.
- Ensured genotype phenotype labels always include sex symbols (for example, `female (&female;)` / `male (&male;)`) in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py).
- Normalized sex-symbol parentheses and glyphs to regular font weight in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py).
- Matched background phrasing to table labels by using "red-eyed (wildtype)" and "white-eyed (mutant)" phrases in [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) and [problems/inheritance-problems/poisson_flies.py](../problems/inheritance-problems/poisson_flies.py).
- Switched [problems/inheritance-problems/poisson_flies.pgml](../problems/inheritance-problems/poisson_flies.pgml) to PGML inline radio blanks and removed the standalone `ANS(...)` call.
- Documented that `ANS(...)` is legacy PG and should be avoided in PGML-first problems unless no alternative exists in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).

## 2026-01-27
- Made the "hydrophobic" emphasis bold in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml).
- Restored HTML subscript formulas in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) and reintroduced regex-based tag stripping for plain-text solution output.
- Simplified [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) to plain ASCII formulas, removed emphasis styling and the hint, and reduced the solution line for ADAPT testing.
- Documented that ADAPT does not render HTML or numeric Unicode entities in solution blocks in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).
- Simplified the solution block in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) to a single plain-text line to align with other PGML solutions.
- Use the Unicode-entity hydrophobic answer directly in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) solution output, removing the unused plain-text variable.
- Converted hydrophilic formulas to numeric Unicode entities in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) and removed the separate plain hydrophobic list.
- Replaced hydrophobic compound formulas in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) with numeric Unicode entities for subscripts to avoid HTML tags in choices.
- Replaced regex-based HTML stripping in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) with a parallel plain-text hydrophobic list for solution output.
- Stripped HTML tags from the solution answer in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) so solution text stays plain.
- Switched the "hydrophobic" emphasis in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) to an HTML span passed through with `*` to avoid PGML tag-wrapper parsing errors.
- Styled "hydrophobic" in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) with larger gold text using a PGML tag wrapper for emphasis.
- Fixed [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) solution output to pass through HTML so subscripts render correctly.
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to use `PopUp` from `parserPopUp.pl` instead of `DropDown` for PG 2.17 compatibility.
- Updated [docs/webwork/MATCHING_PROBLEMS.md](webwork/MATCHING_PROBLEMS.md) to recommend `PopUp` widgets for PG 2.17 compatibility.
- Stabilized matching key selection in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) by sorting `%match_data` keys before seeding, so the same seed yields the same choices.
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to list right-column answers in alphabetical order and map PopUp choices against the sorted list.
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to use `PGsort` instead of `sort` for PG 2.17 safe compartment compatibility.
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) right-column labels to use escaped `A\.` prefixes with PGML variable output so colors render and ordered-list parsing is avoided.
- Added a PopUp/DropDown compatibility wrapper in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to stay compatible with PG 2.17 while allowing DropDown in 2.19+.
- Noted the DropDown/PopUp compatibility guidance in [docs/webwork/MATCHING_PROBLEMS.md](webwork/MATCHING_PROBLEMS.md).
- Switched [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to a local `PGrandom` instance seeded from the problem seed so key selection, prompts, and order are deterministic with a fixed seed.
- Ensured the local `PGrandom` seeding in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) uses `problemSeed` directly for consistent fixed-seed behavior.
- Fixed [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) deterministic selection to index back into sorted keys rather than using raw indices as labels.
- Corrected [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) `PGsort` comparators to use `lt` for stable lexical ordering.
- Adjusted [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to include a blank choice in PopUp/DropDown widgets so dropdowns default to empty instead of "A".
- Added a seed-stable shuffle of multiple-choice options in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) using a local `PGrandom` instance seeded by `problemSeed`.
- Updated [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) to use inline PGML answer specs for `RadioButtons`, remove a trailing loadMacros comma, and wrap the long hint line to satisfy pgml-lint warnings.
- Added [docs/webwork/RANDOMIZATION_REFERENCE.md](webwork/RANDOMIZATION_REFERENCE.md) with a PG randomization function inventory and seed-stability guidance, and linked it from [docs/webwork/INDEX.md](webwork/INDEX.md) and [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).
- Updated [problems/matching_sets/yaml_which_one_mc_to_pgml.py](../problems/matching_sets/yaml_which_one_mc_to_pgml.py) and [problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py](../problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py) to use a local `PGrandom` seeded by `problemSeed` for question selection and to perform seed-stable choice shuffling with `randomize => 0`.
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to emit PGML tag wrappers instead of raw `<div>` tags and remove `MODES(...)` calls inside eval blocks, resolving pgml-lint HTML/MODES errors.
- Updated [tests/test_pgml_generators.py](../tests/test_pgml_generators.py) to expect `PGsort(...)` in the matching generator seed-determinism output.
- Adjusted [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to keep each PGML tag wrapper on a single line so pgml-lint and PG 2.17 do not emit `[< ... line break` parsing errors.
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to restore the MODES-based HTML wrapper layout for PG 2.17 rendering, keeping TeX output empty.
- Documented PG 2.17 HTML-in-PGML guidance in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md) and clarified pgml-lint exceptions in [docs/webwork/PGML_LINTER_EXPECTATIONS.md](webwork/PGML_LINTER_EXPECTATIONS.md).
- Exposed `%answer_index` as a package variable in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) so PGML solution blocks can display correct answer letters.
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) solution output to format answers as numbered mappings (for example `1-C, 2-B, 3-A`).
- Updated [problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py](../problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py) and [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml) to add OPL header tags, use a seed-stable `PGrandom` instance, make the canvas HTML-only, and move RDKit initialization into the header script.
- Added colorized macromolecule choices (HTML with TeX fallbacks) and a plain-text solution label in [problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py](../problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py) and [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml).
- Updated the RDKit canvas size to 480x270 (16:9) in [problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py](../problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py) and [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml).
- Moved the RDKit canvas HTML into a `$canvas_html` variable in [problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py](../problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py) and [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml) to avoid PGML parsing errors.
- Updated macromolecule choice coloring to use HTML-only `MODES(TeX => '', HTML => ...)` with single-quoted spans in [problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py](../problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py) and [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml).
- Fixed the RDKit canvas HTML string concatenation in [problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py](../problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py) and [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml) to avoid PG parser syntax errors.
- Adjusted macromolecule choice styling so only the macromolecule name is colored/bold and the parenthetical descriptor stays plain text in [problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py](../problems/biochemistry-problems/PUBCHEM/generate_macromolecule_id_pgml.py) and [problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml](../problems/biochemistry-problems/PUBCHEM/macromolecule_identification.pgml).
- Added a general `pg-render` shortcut in [source_me.sh](../source_me.sh) to run the renderer script with arbitrary arguments (for example `-r -i file.pgml`).
- Updated hydrogen bond examples in [problems/matching_sets/biochemistry/bond_types.yml](../problems/matching_sets/biochemistry/bond_types.yml) to use escaped Unicode middle dots (`\u00b7`) for a dotted hydrogen bond line.

## 2026-01-26
- Added [problems/matching_sets/color_render_test.pg](../problems/matching_sets/color_render_test.pg) as a single-page PGML color rendering probe for MathJax and CSS styling methods.
- Added [docs/webwork/COLOR_TEXT_IN_WEBWORK.md](webwork/COLOR_TEXT_IN_WEBWORK.md) to document reliable CSS-based coloring and MathJax color failures in this WeBWorK setup.
- Linked [docs/webwork/COLOR_TEXT_IN_WEBWORK.md](webwork/COLOR_TEXT_IN_WEBWORK.md) from [docs/webwork/INDEX.md](webwork/INDEX.md).
- Expanded [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) sub/sup conversion to unescape entities inside tags, normalize minus signs, and map common letter subscripts/superscripts while leaving Greek letters on baseline.
- Documented the color-class migration plan for matching sets in [docs/webwork/COLOR_CLASS_MIGRATION_PLAN.md](webwork/COLOR_CLASS_MIGRATION_PLAN.md) and linked it from [docs/webwork/INDEX.md](webwork/INDEX.md).
- Added [docs/webwork/REPLACEMENT_RULES_IMPLEMENTATION_PLAN.md](webwork/REPLACEMENT_RULES_IMPLEMENTATION_PLAN.md) to define handling plans for sub/sup, tables, colors, and other replacement-rule cases, and linked it from [docs/webwork/INDEX.md](webwork/INDEX.md).
- Refined the replacement-rules plan to note baseline Greek handling, named color parsing, and bold/italic scope for strict conversions in [docs/webwork/REPLACEMENT_RULES_IMPLEMENTATION_PLAN.md](webwork/REPLACEMENT_RULES_IMPLEMENTATION_PLAN.md).
- Added shared HTML sanitization and strict color-span parsing helpers to [webwork_lib.py](../webwork_lib.py) for reuse across PGML generators.
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to support strict replacement-rule color conversion (inline or class mode), PGML-safe sanitization, and table/unsupported span warnings.
- Added pytest coverage for new WebWork helper utilities in [tests/test_webwork_lib.py](../tests/test_webwork_lib.py).
- Added [docs/webwork/HTML_TO_WEBWORK_PLAN.md](webwork/HTML_TO_WEBWORK_PLAN.md) as the master HTML-to-PGML plan and [docs/webwork/NICETABLES_TRANSLATION_PLAN.md](webwork/NICETABLES_TRANSLATION_PLAN.md) for table translation guidance, and linked both from [docs/webwork/INDEX.md](webwork/INDEX.md).
- Adjusted PGML tag wrapper output in [webwork_lib.py](../webwork_lib.py) to use double quotes inside wrappers to avoid PG compile errors, and updated tests accordingly in [tests/test_webwork_lib.py](../tests/test_webwork_lib.py).
- Updated [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) to render colored labels via PGML tag wrappers in the statement block instead of storing wrappers inside match data.
- Switched [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) right-column labels to inline HTML span styling with escaped `A\.` prefixes so PGML does not auto-build ordered lists.
- Reworked [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) to emit right-column labels via HTML built in Perl and injected through `MODES(HTML => ...)` so span styling survives PGML.
- Adjusted [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) to inject right-column HTML directly from a PGML eval block to avoid `MODES(...)` returning `1`.
- Removed PGML parsing on right-column HTML injection in [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) so raw HTML labels render.
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to build HTML-safe answer labels (with strict color span support) and emit them via `[$answers_html[...]]*` so right-column colors survive PGML rendering.
- Added HTML sanitization and span builders to [webwork_lib.py](../webwork_lib.py) and corresponding tests in [tests/test_webwork_lib.py](../tests/test_webwork_lib.py) to support safe raw HTML label output.
- Updated [problems/matching_sets/yaml_which_one_mc_to_pgml.py](../problems/matching_sets/yaml_which_one_mc_to_pgml.py) to render strict color spans as safe HTML in prompts/choices, pass them through PGML with `*`, and add optional class-based styling support.
- Updated [problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py](../problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py) to apply replacement rules with strict color-span handling, emit HTML-safe statements, and support inline coloring with `--no-color` to disable.
- Documented PGML single-pass behavior and the `[$var]*` HTML pass-through pattern across WebWork docs, including [docs/webwork/COLOR_TEXT_IN_WEBWORK.md](webwork/COLOR_TEXT_IN_WEBWORK.md), [docs/webwork/MATCHING_PROBLEMS.md](webwork/MATCHING_PROBLEMS.md), [docs/webwork/HTML_TO_WEBWORK_PLAN.md](webwork/HTML_TO_WEBWORK_PLAN.md), [docs/webwork/REPLACEMENT_RULES_IMPLEMENTATION_PLAN.md](webwork/REPLACEMENT_RULES_IMPLEMENTATION_PLAN.md), [docs/webwork/COLOR_CLASS_MIGRATION_PLAN.md](webwork/COLOR_CLASS_MIGRATION_PLAN.md), and [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md).
- Moved shared replacement-rule helpers (normalize, apply, sanitize, color-span HTML formatting) into [webwork_lib.py](../webwork_lib.py) and updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py), [problems/matching_sets/yaml_which_one_mc_to_pgml.py](../problems/matching_sets/yaml_which_one_mc_to_pgml.py), and [problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py](../problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py) to use them.
- Simplified color flags across PGML generators: removed `--color-mode` in favor of default inline coloring plus `--no-color`, and repurposed `--use-colors` as an explicit enable (no MathJax).
- Added `--use-color` as an alias for `--use-colors` in the PGML YAML generators.
- Added generator unit tests in [tests/test_pgml_generators.py](../tests/test_pgml_generators.py) to cover matching, which-one, and MC statements PGML builders with inline color spans, plus additional helper coverage in [tests/test_webwork_lib.py](../tests/test_webwork_lib.py).
- Documented PGML renderer expectation mismatches and linter checks in [docs/webwork/PGML_LINTER_EXPECTATIONS.md](webwork/PGML_LINTER_EXPECTATIONS.md) and linked it from [docs/webwork/INDEX.md](webwork/INDEX.md).
- Expanded [docs/webwork/PGML_LINTER_EXPECTATIONS.md](webwork/PGML_LINTER_EXPECTATIONS.md) with additional structural, encoding, and macro sanity checks for poorly formed PGML files.
- Added linter guidance for detecting PGML interpolation inside `[@ @]` eval blocks and control characters in [docs/webwork/PGML_LINTER_EXPECTATIONS.md](webwork/PGML_LINTER_EXPECTATIONS.md).
- Added pytest smoke coverage for the three YAML-to-PGML generators that writes outputs to a temp directory and checks for basic PGML markers in [tests/test_pgml_generators.py](../tests/test_pgml_generators.py).
- Reverted [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) right-column output to PGML list markup with CSS coloring on `ol li:nth-child(...)` after inline HTML injection failed to render labels.
- Switched [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) to PGML tag wrappers for the two-column layout to keep right-column list items rendering with CSS nth-child coloring.
- Added fixed label-to-color HTML mapping in [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) and emit it via `[$answers_html[...]]*` so label colors follow meaning instead of position.
- Documented the working fixed-label color approach for matching problems in [docs/webwork/COLOR_TEXT_IN_WEBWORK.md](webwork/COLOR_TEXT_IN_WEBWORK.md).
- Escaped right-column matching labels to `A\.` in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) and regenerated [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) to avoid double-letter list rendering.
- Sorted matching keys before NchooseK selection in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) and regenerated [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml) so a fixed seed yields deterministic matching sets.
- Documented fixed-seed determinism for randomization in [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md) and added a generator test to enforce sorted matching keys in [tests/test_pgml_generators.py](../tests/test_pgml_generators.py).
- Updated [problems/matching_sets/check_pg_macro_status.pg](../problems/matching_sets/check_pg_macro_status.pg) to verify macro existence with `findMacroFile` and report missing macros instead of always printing OK.

## 2026-01-24
- Updated [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to emit the `matching_from_web.pgml` MODES-based layout with HTML flexbox wrappers and TeX placeholders for reliable matching renders.
- Adjusted [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to strip HTML tags from YAML content, wrap prompt/choice variables in PGML brackets, color the right column via CSS on the container (position-based), and unescape HTML entities into Unicode characters.
- Converted `<sub>` and `<sup>` tags in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to Unicode subscripts/superscripts before stripping other HTML.
- Switched the right-column labels in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to escaped `A\.` text (avoids PGML ordered-list parsing), and normalized non-breaking spaces after entity unescape.
- Documented the `A\.` right-column label requirement in [docs/webwork/MATCHING_PROBLEMS.md](webwork/MATCHING_PROBLEMS.md) to prevent PGML ordered-list parsing.
- Set matching layout `MODES(TeX => '')` wrappers in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) since TeX output is not supported.
- Added `--use-colors` in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to bake MathJax-colored choice labels in Python using PGML math strings (`[\color{#HEX}{\text{...}}]`) from the qti color wheel palette, with stable ordering and CSS nth-child colors disabled when enabled.
- Defined `@ALPHABET` in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) to ensure matching labels render as A/B/C/etc.
- Refreshed WebWork docs to document PGML HTML whitelist constraints (blocked `table`/`tr`/`td`) and the MODES-based matching layout in [docs/webwork/MATCHING_PROBLEMS.md](webwork/MATCHING_PROBLEMS.md), [docs/webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md](webwork/WEBWORK_PROBLEM_AUTHOR_GUIDE.md), [docs/webwork/WEBWORK_HEADER_STYLE.md](webwork/WEBWORK_HEADER_STYLE.md), and [docs/webwork/INDEX.md](webwork/INDEX.md).

## 2026-01-23
- Converted [problems/biochemistry-problems/which_hydrophobic-simple.py](../problems/biochemistry-problems/which_hydrophobic-simple.py) to self-contained PGML format as [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml).
- Fixed `NchooseK` undefined error in [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) by adding `PGchoicemacros.pl` to the loadMacros list.
- Added concise two-sentence `BEGIN_PGML_HINT` to [problems/biochemistry-problems/which_hydrophobic-simple.pgml](../problems/biochemistry-problems/which_hydrophobic-simple.pgml) explaining that hydrophobic compounds are mostly carbon and hydrogen.
- Updated [source_me.sh](../source_me.sh) to add PGML linter (`pgml-lint`) to the environment setup, making it available as a shell function after sourcing the script.
- Enhanced [webwork_lib.py](../webwork_lib.py) to automatically populate OPL header fields (Date, Author, Institution) with default values when not specified in YAML files, affecting both [problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py](../problems/multiple_choice_statements/yaml_mc_statements_to_pgml.py) and [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py).
- Fixed potential unbound variable bug in [webwork_lib.py](../webwork_lib.py) KEYWORDS handling by moving keyword_blob append inside the else block.
- Improved [devel/commit_changelog.py](../devel/commit_changelog.py) to generate descriptive commit messages that include the first change and count remaining changes instead of just "docs: update changelog for DATE".
- Removed "docs: " prefix from [devel/commit_changelog.py](../devel/commit_changelog.py) commit messages to reduce noise (changelog entries are self-descriptive).
- Changed default output filename in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) from "matching-bond_types.pgml" to "bond_types-matching.pgml" so files don't all start with the same prefix.
- Verified that [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) preserves dark colors from replacement_rules in YAML files (colors already working via `<span style="color: ...">` tags).
- Created [problems/matching_sets/yaml_which_one_mc_to_pgml.py](../problems/matching_sets/yaml_which_one_mc_to_pgml.py) as PGML equivalent of [problems/matching_sets/yaml_make_which_one_multiple_choice.py](../problems/matching_sets/yaml_make_which_one_multiple_choice.py), generating "which one" multiple choice questions from matching set YAML files with support for --flip option.
- Fixed `NchooseK` undefined error in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) by adding `PGchoicemacros.pl` to the loadMacros list.
- Created [devel/add_dbsubject_to_yaml.py](../devel/add_dbsubject_to_yaml.py) script to automatically add `dbsubject` metadata to YAML files based on folder location.
- Added `dbsubject` field to 51 YAML files in [problems/matching_sets/](../problems/matching_sets/) and 47 YAML files in [problems/multiple_choice_statements/](../problems/multiple_choice_statements/) using folder-based subject mapping (biochemistry->Biochemistry, inheritance->Genetics, laboratory->Laboratory Techniques, etc.).
- Fixed PGML matching prompt/choice rendering in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) by emitting literal PGML variable references inside generated list blocks.
- Updated matching PGML outputs to use the corrected prompt/choice rendering in [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml), [problems/matching_sets/matching.pgml](../problems/matching_sets/matching.pgml), and [problems/matching_sets/matching-macromolecules-biol301.pgml](../problems/matching_sets/matching-macromolecules-biol301.pgml).
- Switched matching PGML rendering to emit explicit prompt/choice lines (no runtime join) in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) and refreshed [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml), [problems/matching_sets/matching.pgml](../problems/matching_sets/matching.pgml), and [problems/matching_sets/matching-macromolecules-biol301.pgml](../problems/matching_sets/matching-macromolecules-biol301.pgml) to ensure PGML parses the dropdowns and text.
- Adjusted matching PGML prompt/choice substitutions to use raw PGML eval blocks so HTML in prompts/choices renders correctly in [problems/matching_sets/yaml_match_to_pgml.py](../problems/matching_sets/yaml_match_to_pgml.py) and [problems/matching_sets/bond_types-matching.pgml](../problems/matching_sets/bond_types-matching.pgml).
- Added [problems/matching_sets/matching_full_fix.pgml](../problems/matching_sets/matching_full_fix.pgml) as a parserPopUp-based matching example (MatchingAlt-style, HTML-only layout) derived from [problems/matching_sets/matching_semifix.pgml](../problems/matching_sets/matching_semifix.pgml).
- Replaced the PGML solution join block in [problems/matching_sets/matching_full_fix.pgml](../problems/matching_sets/matching_full_fix.pgml) with a precomputed answer string to avoid unstable inline evaluation.
- Styled pipet labels as circular badges and added subtle pipet-specific colors with rounded digit windows in `problems/laboratory-problems/pipet_size_mc.py`.
- Refactored `problems/laboratory-problems/pipet_size_mc.py` to split pipet HTML and volume formatting into helper subfunctions.
- Changed pipet digit windows to rigid boxed cells with white backgrounds to match the side display in `problems/laboratory-problems/pipet_size_mc.py`.
- Centered pipet digit text in the boxed display cells in `problems/laboratory-problems/pipet_size_mc.py`.
- Added a red-digit place-value hint to the pipet question text in `problems/laboratory-problems/pipet_size_mc.py`.
- Added `problems/laboratory-problems/lab_helper_lib.py` for shared HTML formatting helpers in solution questions.
- Moved solution question numeric details into consistent bordered info tables with monospace values in `problems/laboratory-problems/solution-*.py`.
- Moved solution question prompts after the info tables so the question sits closer to the response entry in `problems/laboratory-problems/solution-*.py`.
- Slightly increased the font size for the key request phrase in solution question prompts via `lab_helper_lib.py`.
- Added compound name rows to the solution info tables for context in `problems/laboratory-problems/solution-*.py`.
- Moved compound names into a two-column header row at the top of the solution info tables in `problems/laboratory-problems/solution-*.py`.
- Applied `lab_helper_lib.py` table formatting to `problems/laboratory-problems/percent_dilution_aliquot_numeric.py` for compound context and clearer dilution prompts.
- Emphasized key dilution details with monospace and larger text in `problems/laboratory-problems/dilution_factor_*.py` and `problems/laboratory-problems/serial_dilution_factor_*.py`.
- Standardized color cues for DF, aliquot, diluent, and stock solution text across laboratory dilution questions using `lab_helper_lib.py`.
- Updated dilution prompts to color the full aliquot/diluent/stock phrases and aligned the diluent blue to `#005cb3` in `lab_helper_lib.py`.

## 2026-01-22
- Resolved merge conflicts in [docs/CODE_ARCHITECTURE.md](docs/CODE_ARCHITECTURE.md) and [docs/FILE_STRUCTURE.md](docs/FILE_STRUCTURE.md) to align test/tool references with the current repo layout.
- Standardized lxml etree imports in gene mapping and treelib HTML validation helpers after merge resolution.
- Removed legacy [problems/multiple_choice_statements/yaml_to_pg.py](../problems/multiple_choice_statements/yaml_to_pg.py) during conflict cleanup to match the current PGML workflow.
