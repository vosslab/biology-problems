<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>wordle_game.js debug</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- RDKit for setupGame renderSequence path -->
	<script src="https://unpkg.com/@rdkit/rdkit/dist/RDKit_minimal.js"></script>

	<!-- Your code under test -->
	<script src="wordle_peptides.js"></script>
	<script src="wordle_words.js"></script>
	<script src="wordle_stats.js"></script>
	<script src="wordle_game.js"></script>

	<style>
		body { font-family: system-ui, Arial, sans-serif; margin: 20px; }
		section { margin-bottom: 24px; border: 1px solid #ddd; padding: 10px; }
		section h3 { margin-top: 0; }
		label { display: inline-block; min-width: 140px; }
		input, button { font: inherit; }
		pre { background: #f3f3f3; padding: 8px; white-space: pre-wrap; }
		#board-test .cell {
			display: inline-block;
			width: 1.4em;
			height: 1.4em;
			line-height: 1.4em;
			text-align: center;
			margin-right: 2px;
			border: 1px solid #ccc;
			font-weight: bold;
			text-transform: uppercase;
		}
		#board-test .correct { background: #6aaa64; color: #ffffff; border-color: #6aaa64; }
		#board-test .present { background: #c9b458; color: #ffffff; border-color: #c9b458; }
		#board-test .absent { background: #787c7e; color: #ffffff; border-color: #787c7e; }
	</style>
</head>
<body>
	<h2>wordle_game.js debug</h2>

	<section>
		<h3>scoreGuess</h3>
		<label for="answer-score">Answer:</label>
		<input id="answer-score" value="ACRID" maxlength="5">
		<br>
		<label for="guess-score">Guess:</label>
		<input id="guess-score" value="ARISE" maxlength="5">
		<button id="btn-score" type="button">Score guess</button>
		<pre id="score-output"></pre>
	</section>

	<section>
		<h3>isValidGuess</h3>
		<label for="guess-valid">Guess:</label>
		<input id="guess-valid" value="ACRID" maxlength="5">
		<button id="btn-valid" type="button">Check</button>
		<pre id="valid-output"></pre>
	</section>

	<section>
		<h3>renderBoard</h3>
		<p>This uses a fixed example array of guesses.</p>
		<button id="btn-board-test" type="button">Render example board</button>
		<div id="board-test"></div>
	</section>

	<section>
		<h3>setupGame smoke test</h3>
		<p>This creates minimal game DOM and calls setupGame once.</p>
		<button id="btn-setup-game" type="button">Run setupGame</button>
		<div id="game-root" style="margin-top:10px; border-top:1px dashed #ccc; padding-top:8px;">
			<div id="top-bar">
				<h3>Game area</h3>
				<div id="stats"></div>
			</div>
			<div id="message"></div>
			<form id="guess-form" autocomplete="off">
				<label for="guess">Guess:</label>
				<input id="guess" maxlength="5">
				<button type="submit">Enter</button>
			</form>
			<div id="board"></div>
			<div id="keyboard"></div>
			<div id="peptide"></div>
			<div id="toast-container"></div>
		</div>
	</section>

	<script>
	/* global WORD_LIST,
	          scoreGuess, isValidGuess,
	          renderBoard, setupGame,
	          initRDKitModule, RDKitModule */

	// scoreGuess
	document.getElementById("btn-score").addEventListener("click", function () {
		var out = document.getElementById("score-output");
		if (typeof scoreGuess !== "function") {
			out.textContent = "scoreGuess is not defined.";
			return;
		}
		var answer = document.getElementById("answer-score").value.trim().toUpperCase();
		var guess = document.getElementById("guess-score").value.trim().toUpperCase();
		if (answer.length !== 5 || guess.length !== 5) {
			out.textContent = "Both guess and answer must be 5 letters.";
			return;
		}
		var result = scoreGuess(guess, answer);
		out.textContent =
			"answer: " + answer + "\n" +
			"guess:  " + guess + "\n" +
			"score:  " + JSON.stringify(result);
	});

	// isValidGuess
	document.getElementById("btn-valid").addEventListener("click", function () {
		var out = document.getElementById("valid-output");
		if (typeof isValidGuess !== "function") {
			out.textContent = "isValidGuess is not defined.";
			return;
		}
		if (typeof WORD_LIST === "undefined") {
			out.textContent = "WORD_LIST is not defined.";
			return;
		}
		var guess = document.getElementById("guess-valid").value.trim().toUpperCase();
		var ok = isValidGuess(guess, WORD_LIST);
		out.textContent = "Guess: " + guess + "\nValid: " + ok;
	});

	// renderBoard test
	document.getElementById("btn-board-test").addEventListener("click", function () {
		var container = document.getElementById("board-test");
		container.innerHTML = "";
		if (typeof renderBoard !== "function") {
			container.textContent = "renderBoard is not defined.";
			return;
		}
		var exampleGuesses = [
			{ guess: "ARISE", result: ["present", "present", "absent", "absent", "correct"] },
			{ guess: "ACRID", result: ["correct", "correct", "correct", "correct", "correct"] }
		];
		renderBoard(container, exampleGuesses);
	});

	// setupGame smoke test
	document.getElementById("btn-setup-game").addEventListener("click", function () {
		var btn = this;
		if (typeof setupGame !== "function") {
			alert("setupGame is not defined in wordle_game.js");
			return;
		}
		if (typeof initRDKitModule === "function" && typeof RDKitModule === "undefined") {
			initRDKitModule().then(function (instance) {
				window.RDKitModule = instance;
				console.log("RDKit " + RDKitModule.version());
				setupGame();
				btn.disabled = true;
			}).catch(function (e) {
				console.error("RDKit init failed for setupGame test", e);
				setupGame();
				btn.disabled = true;
			});
		} else {
			setupGame();
			btn.disabled = true;
		}
	});
	</script>
</body>
</html>
